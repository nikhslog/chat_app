<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage Chat</title>
    <style>
        @font-face {
            font-family: 'Rumburak';
            src: url('rumburak/Rumburak.ttf') format('truetype');
        }
        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Rumburak', serif;
            overflow-x: hidden;
        }
        .hero {
            height: 100vh;
            background: url('Untitled design (5).png') center/cover no-repeat;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .text-wrapper {
            transform: translateY(30px) translateX(-100px);
            z-index: 1;
        }
        .text {
            color: #0b141a;
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 10px 0;
            line-height: 1.4;
            max-width: 900px;
        }
        .animated-word-wrapper {
            display: inline-block;
            line-height: 1;
            vertical-align: baseline;
        }
        .animated-word {
            color: white;
            font-weight: bold;
            border-right: 2px solid white;
            white-space: nowrap;
            overflow: hidden;
            display: inline-block;
        }
        .chat-section {
            min-height: 100vh;
            background: url('Untitled design (7).png') center/cover no-repeat;
            padding: 2rem;
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }
        .chat-container {
            width: 300px;
            height: 400px;
            background: rgba(229, 229, 229, 0.85);
            border-radius: 10px;
            border: 2px solid #4a5568;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-left: 50px;
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            padding: 10px;
            background: #4a5568;
            color: white;
            border-radius: 8px 8px 0 0;
            font-size: 0.9rem;
            text-align: center;
        }
        .name-selection-area {
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            text-align: center;
        }
        .user-info {
            padding: 8px;
            background: #1a202c;
            color: white;
            text-align: center;
            margin-top: 10px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.6);
        }
        .message {
            margin: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 80%;
            font-size: 0.9rem;
            font-family: serif;
        }
        .sent {
            background: #4a5568;
            color: white;
            margin-left: auto;
        }
        .received {
            background: #d1d5db;
            color: #1a202c;
            margin-right: auto;
        }
        .chat-input {
            display: flex;
            padding: 10px;
            background: #4a5568;
            border-radius: 0 0 8px 8px;
        }
        .chat-input input {
            flex-grow: 1;
            padding: 5px 10px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            margin-right: 5px;
            font-family: serif;
            background: rgba(255, 255, 255, 0.9);
        }
        .chat-input button {
            padding: 5px 10px;
            background: #1a202c;
            color: white;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            cursor: pointer;
            font-family: serif;
        }
        .join-button {
            padding: 10px 20px;
            background: #1a202c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

</head>
<body>
    <section class="hero">
        <div class="text-wrapper">
            <div class="text">
                That Shah Jahan didn't have the chance to show the Taj to his Mumtaz but,
            </div>
            <div class="text">
                I got to show my Taj Mahal to 
                <span class="animated-word-wrapper">
                    <span class="animated-word"></span>
                </span>
            </div>
        </div>
    </section>

    <section class="chat-section">
        <div class="chat-container">
            <div class="chat-header">
                <span>Vintage Chat</span>
            </div>
            <div class="name-selection-area" id="nameSelection">
                <div>Click to join chat:</div>
                <button class="join-button" onclick="joinChat()">Join Chat</button>
                <div class="user-info" id="currentUserInfo"></div>
            </div>
            <div class="chat-messages" id="messageArea"></div>
            <div class="chat-input">
                <input type="text" id="messageInput" placeholder="Write a message...">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>
    </section>

    <script>
        // Replace this config with your Firebase config
        const firebaseConfig = {
          apiKey: "AIzaSyDuk-a6uQ_IMCqOzahu3jlozaDgJX-G36k",
          authDomain: "vintage-chat-36952.firebaseapp.com",
          databaseURL: "https://vintage-chat-36952-default-rtdb.firebaseio.com",
          projectId: "vintage-chat-36952",
          storageBucket: "vintage-chat-36952.firebasestorage.app",
          messagingSenderId: "502268108781",
          appId: "1:502268108781:web:231b380f8abdfa78f751e4",
          measurementId: "G-1DHFHTYP7C"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let currentUser = '';

        // Add this right after firebase.initializeApp(firebaseConfig);
        if (!firebase.apps.length) {
            console.error('Firebase failed to initialize');
        } else {
            console.log('Firebase initialized successfully');
        }

        // Test database connection
        db.ref('.info/connected').on('value', (snap) => {
            if (snap.val() === true) {
                console.log('Connected to Firebase');
            } else {
                console.log('Disconnected from Firebase');
            }
        });

        function joinChat() {
            // Check available usernames
            db.ref('users').once('value', (snapshot) => {
                const users = snapshot.val() || {};
                
                if (!users.nikhilTaken) {
                    currentUser = 'Nikhil';
                    db.ref('users').update({ nikhilTaken: true });
                } else if (!users.nikhTaken) {
                    currentUser = 'Nikh';
                    db.ref('users').update({ nikhTaken: true });
                } else {
                    alert('Chat room is full!');
                    return;
                }

                // Update UI
                document.getElementById('nameSelection').style.display = 'none';
                document.getElementById('messageArea').style.display = 'block';
                document.querySelector('.chat-input').style.display = 'flex';
                document.getElementById('currentUserInfo').textContent = `You are: ${currentUser}`;

                // Send join message
                db.ref('messages').push({
                    sender: 'System',
                    text: `${currentUser} has joined the chat`,
                    timestamp: Date.now()
                });
            });
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (message && currentUser) {
                db.ref('messages').push({
                    sender: currentUser,
                    text: message,
                    timestamp: Date.now()
                });
                messageInput.value = '';
            }
        }

        // Listen for messages
        db.ref('messages').on('value', (snapshot) => {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = '';
            
            const messages = snapshot.val() || {};
            Object.values(messages).forEach(msg => {
                const div = document.createElement('div');
                div.className = `message ${msg.sender === currentUser ? 'sent' : 'received'}`;
                if (msg.sender === 'System') {
                    div.style.backgroundColor = '#718096';
                    div.style.color = 'white';
                    div.style.textAlign = 'center';
                }
                div.textContent = msg.sender === 'System' ? msg.text : `${msg.sender}: ${msg.text}`;
                messageArea.appendChild(div);
            });
            messageArea.scrollTop = messageArea.scrollHeight;
        });

        // Handle user disconnect
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                db.ref('users').update({
                    [currentUser === 'Nikhil' ? 'nikhilTaken' : 'nikhTaken']: false
                });
                db.ref('messages').push({
                    sender: 'System',
                    text: `${currentUser} has left the chat`,
                    timestamp: Date.now()
                });
            }
        });
        // Initial UI setup
        document.getElementById('messageArea').style.display = 'none';
        document.querySelector('.chat-input').style.display = 'none';
    </script>
</body>
</html>